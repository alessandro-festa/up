# Default values for suse-ai-up Helm chart
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Image configuration
image:
  repository: ghcr.io/alessandro-festa/suse-ai-up
  tag: "latest"
  # Architecture-specific tag suffix (e.g., "-amd64", "-arm64", or "" for multi-arch)
  # Leave empty for multi-architecture images, or set to "-amd64"/"-arm64" for architecture-specific
  architectureTagSuffix: ""
  pullPolicy: IfNotPresent

# Service configuration
service:
  type: ClusterIP
  port: 8911
  annotations: {}
  # Example annotations for Prometheus
  # annotations:
  #   prometheus.io/scrape: "true"
  #   prometheus.io/port: "8911"
  #   prometheus.io/path: "/metrics"

# Deployment configuration
replicaCount: 1
resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Pod configuration
podAnnotations: {}
podLabels: {}
nodeSelector: {}
tolerations: []
affinity: {}
# Architecture-specific node affinity (optional)
# Set architecture to "amd64" or "arm64" to ensure pods run on nodes with matching architecture
architecture: ""

# Environment variables
env:
  # Core service configuration
  authMode: "development"
  registryEnabled: true
  smartAgentsEnabled: true
  port: "8911"
  host: "0.0.0.0"

  # MCP server runtime support
  python:
    enabled: true
    version: "3.11"
  nodejs:
    enabled: true
    version: "18"

  # MCP server spawning configuration
  spawning:
    retryAttempts: 3
    retryBackoffMs: 2000
    defaultCpu: "500m"
    defaultMemory: "256Mi"
    maxCpu: "1000m"
    maxMemory: "1Gi"
    logLevel: "debug"
    includeContext: true

# OpenTelemetry Configuration
otel:
  enabled: false
  serviceName: "suse-ai-up"
  serviceVersion: "1.0.0"

  # Additional labels for OTEL service
  serviceLabels:
    genai.system.suseai-up: "true"

  # OTEL Collector Configuration
  collector:
    image: otel/opentelemetry-collector-contrib:latest
    imagePullPolicy: IfNotPresent
    resources:
      requests:
        memory: "128Mi"
        cpu: "50m"
      limits:
        memory: "256Mi"
        cpu: "200m"

  # OTEL Core Configuration
  core:
    tracesExporter: "otlp"
    metricsExporter: "otlp"
    logsExporter: "otlp"
    otlpEndpoint: "http://localhost:4318"
    otlpProtocol: "grpc"
    insecure: "true"

  # Application OTEL Configuration
  app:
    enabled: false
    endpoint: "http://localhost:4318"
    protocol: "grpc"

  # OTEL Resource Attributes
  resourceAttributes:
    - key: "service.instance.id"
      value: "{{ include \"suse-ai-up.fullname\" . }}"
    - key: "k8s.namespace.name"
      value: "{{ .Release.Namespace }}"
    - key: "k8s.pod.name"
      value: "{{ include \"suse-ai-up.fullname\" . }}"

  # OTEL Sampling
  sampling:
    traces:
      sampler: "parentbased_always_on"
      ratio: 1.0

  # OTEL Exporters
  exporters:
    jaeger:
      enabled: true
      endpoint: "jaeger-collector:14268/api/traces"
      insecure: true
    prometheus:
      enabled: true
      endpoint: "0.0.0.0:8889"
    logging:
      enabled: true
      verbosity: "detailed"

# Health check configuration
healthCheck:
  enabled: false
  path: "/health"
  port: 8911
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: suse-ai-up.local
      paths:
        - path: /
          pathType: Prefix
  tls: []
  #  - secretName: suse-ai-up-tls
  #    hosts:
  #      - suse-ai-up.local

# Horizontal Pod Autoscaler
hpa:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget
pdb:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Security Context
podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# Network Policies
networkPolicy:
  enabled: false
  # Allow traffic from specific namespaces
  allowedNamespaces: []
  # Allow traffic from specific pods
  allowedPods: []

# ConfigMaps for additional configuration
extraConfigMaps: {}
# extraConfigMaps:
#   my-config:
#     data:
#       config.yaml: |
#         key: value

# Secrets for sensitive configuration
extraSecrets: {}
# extraSecrets:
#   my-secret:
#     data:
#       api-key: <base64-encoded-value>

# Additional volumes
extraVolumes: []
# extraVolumes:
# - name: my-volume
#   configMap:
#     name: my-config

# Additional volume mounts
extraVolumeMounts: []
# extraVolumeMounts:
# - name: my-volume
#   mountPath: /etc/my-config
#   readOnly: true

# Additional environment variables from ConfigMaps/Secrets
extraEnvVars: []
# extraEnvVars:
# - name: MY_VAR
#   valueFrom:
#     configMapKeyRef:
#       name: my-config
#       key: my-key
# - name: MY_SECRET
#   valueFrom:
#     secretKeyRef:
#       name: my-secret
#       key: my-key

# Init containers
initContainers: []
# initContainers:
# - name: init-myservice
#   image: busybox:1.35
#   command: ['sh', '-c', 'echo "init complete"']

# Sidecar containers
sidecarContainers: []
# sidecarContainers:
# - name: my-sidecar
#   image: nginx:1.21
#   ports:
#   - containerPort: 80