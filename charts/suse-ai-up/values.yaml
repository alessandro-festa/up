# SUSE AI Universal Proxy Helm Chart Values
# This file contains all configurable values for the SUSE AI Universal Proxy

# Installation type (used by questions.yaml for UI logic)
installType: "quickstart"  # quickstart or custom

# Service resource profile (used by questions.yaml for UI logic)
serviceResources: "standard"  # light, standard, heavy, or custom

# Global configuration
global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

  # Pod disruption budget
  podDisruptionBudget:
    enabled: false
    minAvailable: 1

  # Node selector, tolerations, and affinity
  nodeSelector: {}
  tolerations: []
  affinity: {}

# Image configuration
image:
  registry: suse
  repository: suse-ai-up
  tag: "latest"
  pullPolicy: IfNotPresent

  # Multi-architecture support
  architecture:
    - amd64
    - arm64

# Service enablement and configuration
services:
  # Primary proxy service (always enabled)
  proxy:
    enabled: true
    port: 8080
    tlsPort: 38080
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

  # Registry service (starts after proxy)
  registry:
    enabled: true
    port: 8913
    tlsPort: 38913
    syncInterval: 24h  # How often to sync external registries
    enableOfficial: true  # Sync official MCP registry
    enableDocker: true    # Sync Docker MCP images
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

  # Discovery service (starts after registry)
  discovery:
    enabled: true
    port: 8912
    tlsPort: 38912
    defaultTimeout: 30s
    maxConcurrency: 10
    excludeProxy: true  # Don't scan proxy ports
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

  # Plugins service (starts last)
  plugins:
    enabled: true
    port: 8914
    tlsPort: 38914
    healthInterval: 30s
    resources:
      requests:
        cpu: 50m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 256Mi

# TLS Configuration
tls:
  enabled: true
  autoGenerate: true  # Generate self-signed certificates

  # Custom certificate configuration
  certFile: ""  # Path to certificate file
  keyFile: ""   # Path to private key file

  # Certificate secret name (if using external certs)
  secretName: "suse-ai-up-tls"

# Authentication Configuration
auth:
  method: "oauth"  # oauth, bearer, apikey, basic, none

  # OAuth 2.0 configuration
  oauth:
    enabled: false
    clientId: ""
    clientSecret: ""
    authorizationUrl: ""
    tokenUrl: ""
    redirectUrl: ""

  # API Key configuration
  apikey:
    enabled: false
    header: "X-API-Key"
    secretName: ""

  # Bearer token configuration
  bearer:
    enabled: false
    token: ""

# Monitoring Configuration
# Note: This chart does not install Prometheus/Grafana.
# Install them separately and configure connections below.
monitoring:
  enabled: false

  # Prometheus configuration (connects to existing Prometheus)
  prometheus:
    enabled: false
    existingService: ""  # Name of existing Prometheus service
    namespace: "monitoring"

    # ServiceMonitor configuration for Prometheus Operator
    serviceMonitor:
      enabled: true
      interval: 30s
      scrapeTimeout: 10s
      labels: {}

  # Grafana configuration (connects to existing Grafana)
  grafana:
    enabled: false
    existingService: ""  # Name of existing Grafana service
    namespace: "monitoring"

    # Grafana dashboard configuration
    dashboard:
      enabled: true
      tags: ["ai", "mcp", "proxy"]

# Ingress Configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: suse-ai-up.local
      paths:
        - path: /
          pathType: Prefix
  tls:
    - secretName: suse-ai-up-tls
      hosts:
        - suse-ai-up.local

# Service Configuration
service:
  type: ClusterIP
  annotations: {}

  # Individual service ports
  ports:
    proxy:
      http: 8080
      https: 38080
    registry:
      http: 8913
      https: 38913
    discovery:
      http: 8912
      https: 38912
    plugins:
      http: 8914
      https: 38914
    health:
      http: 8911
      https: 3911

# Pod Security Context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  fsGroup: 65534

# Security Context
securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 65534
  runAsGroup: 65534
  capabilities:
    drop:
      - ALL

# Network Policies
networkPolicy:
  enabled: false
  allowExternal: true

# Persistence Configuration
persistence:
  enabled: false
  accessMode: ReadWriteOnce
  size: 10Gi
  storageClass: ""

# Logging Configuration
logging:
  level: "info"  # debug, info, warn, error
  format: "json"  # json, text
  outputs:
    - stdout
    - file

# Metrics Configuration
metrics:
  enabled: true
  path: "/metrics"
  port: 9090

# Probes Configuration
probes:
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  startupProbe:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30

# Horizontal Pod Autoscaler
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Resource quotas and limits
quotas:
  enabled: false
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "2"
    memory: "4Gi"

# Custom environment variables
extraEnvVars: []

# Custom volumes
extraVolumes: []

# Custom volume mounts
extraVolumeMounts: []

# Additional containers
extraContainers: []

# Init containers
initContainers: []

# Lifecycle hooks
lifecycle: {}

# Termination grace period
terminationGracePeriodSeconds: 30

# Priority class
priorityClassName: ""

# Service account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# RBAC configuration
rbac:
  create: true
  rules: []

# Pod annotations
podAnnotations: {}

# Deployment annotations
deploymentAnnotations: {}

# Service annotations
serviceAnnotations: {}